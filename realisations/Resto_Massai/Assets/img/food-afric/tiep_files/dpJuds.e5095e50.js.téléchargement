(this.$WP=this.$WP||[]).push(["S07X1M/dpJuds",(e,a)=>{"use strict";var t,o,l,i,r,n,d,s,c,u,p,m,v,g,_,h,f,b,k,E,C,U,w,F,T,y,S,N,P,x,I,z,M,D,R,L=(e,a)=>{var[t,l]=o.useState(!1),i=u();return p("dragover",(e=>{var a=e;null!=a.dataTransfer&&[...a.dataTransfer.items].some((e=>"file"===e.kind))&&(a.dataTransfer.dropEffect="copy",a.preventDefault(),l(!0))})),p("dragleave",(e=>{t&&(e.preventDefault(),l(!1))})),p("drop",(o=>{if(t){var r=o;r.preventDefault(),l(!1);var n=[];null!=r.dataTransfer&&(n=(r.dataTransfer.items?[...r.dataTransfer.items].map((e=>e.getAsFile())):[...r.dataTransfer.files]).filter(Boolean)),n.length>0&&(null!==a&&i({PhotoUploadFlow:{photoUploadWeb:{action:"fileSelectedDragDrop",description:a.length.toString()}}}),e(n))}})),{dragging:t}},O=(e,a,t)=>{var{localize:l}=r(),i=o.useCallback((e=>"video"===t?`${e.name}: ${l.string("post_video_file_type_error")}`:`${e.name}: ${l.string("post_photo_unsupported_file")}`),[l,t]),n=o.useCallback((e=>"video"===t?`${e.name}: ${l.string("post_video_size_error")}`:`${e.name}: ${l.string("file_size_too_big_photo_oops_message",{0:l.string("mobile_offline_megabyte_ffffec6c",{0:a/1024/1024})})}`),[l,a,t]);return o.useCallback((o=>{if(o.size>a)return Promise.reject(new Error(n(o)));var l=m(o.name);return l&&e.includes(l)?"video"===t?Promise.resolve():new Promise(((e,a)=>{var t=new Image;t.onload=()=>{URL.revokeObjectURL(t.src),e()},t.onerror=()=>a(new Error(i(o))),t.src=URL.createObjectURL(o)})):Promise.reject(new Error(i(o)))}),[e,a,i,n,t])},W=(e,a,t,o)=>{e({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFailStatus",description:a.statusText}}}),e({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFailStatusCode",description:a.status}}}),e({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFailResponse",description:a.response.toString()}}}),e({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFail",description:`${t+1} of ${o}`}}})},A=()=>{var e=u(),[a,t]=o.useState(),l=o.useRef(!1);o.useEffect((()=>(l.current=!0,()=>{l.current=!1})),[]);var[,i]=_(T),[,r]=_(S),n=o.useCallback((e=>{if(l.current)return e;throw new Error("upload aborted")}),[]),d=o.useCallback((({mediaType:a,file:o,description:l,locationId:d,isForCuration:s},c,u)=>{var p={description:l,mediaType:"video"===a?"VIDEO":"PHOTO",mimeType:o.type,fileName:o.name,fileSize:o.size,locationIds:null!=d&&d>0?[d]:[],isForCuration:s};return("video"===a?i({request:p}):(e=>new Promise(((a,t)=>{var o=new Image;o.onload=()=>{URL.revokeObjectURL(o.src),a({width:o.width,height:o.height})},o.onerror=t,o.src=URL.createObjectURL(e)})))(o).then((({width:e,height:a})=>i({request:{...p,width:e,height:a}})))).then(n).then((({data:l,error:i})=>{var r,n,d;if(i||"OK"!==(null==l||null==(r=l.initiateMediaUpload)?void 0:r.status)||null==(null==l||null==(n=l.initiateMediaUpload)?void 0:n.mediaId)||null==(null==l||null==(d=l.initiateMediaUpload)?void 0:d.uploadUrl))throw new Error("Upload failed");var{mediaId:s,uploadUrl:p}=l.initiateMediaUpload;return((e,a,o,l,i,r,n,d)=>new Promise(((d,s)=>{var u=new XMLHttpRequest;u.open("PUT",o,!0),u.onload=()=>{200===u.status?(n||l({PhotoUploadFlow:{photoUploadWeb:{action:"uploadSuccess",description:`${i+1} of ${r}`}}}),d(a)):(n||W(l,u,i,r),s(new Error(`Upload of file ${e.name} failed.`)))},u.onerror=()=>{n||W(l,u,i,r),s(new Error(`Upload of file ${e.name} failed.`))},u.onabort=()=>s(new Error(`Upload of file ${e.name} aborted.`)),u.upload.onprogress=e=>{return a=e.loaded,t((e=>{var t=null==e?[]:[...e];return t[c]=a,t}));var a},u.send(e)})))(o,s,p,e,c,u.length,"video"===a)})).then(n).then((e=>r({request:{mediaId:e}}).then((()=>({mediaId:e}))))).finally((()=>{t(null)}))}),[i,r,n,e]);return[{progress:a},o.useCallback((e=>Promise.all(e.map(d))),[d])]},$=({mediaType:e,withMetadata:a,isForCuration:t,allowedFileTypes:l,maxFileSize:i,maxAllowedFiles:n,locationId:d})=>{var s=u(),{localize:c}=r(),p=O(l,i,e),[m,v]=o.useState({media:[],error:null}),g=o.useCallback((e=>{v((a=>({...a,error:e})))}),[]),[_,h]=o.useState(!1),f="video"===e,b=f?P.maxAllowedFiles:N.maxAllowedFiles,k=o.useCallback((a=>{p(a).then((()=>{v((o=>o.media.some((e=>{return t=e.file,o=a,t.name===o.name&&t.size===o.size;var t,o}))?o:o.media.length>=n?n!==b?o:{error:f?c.string("video_upload_max_number",{nVideos:n}):c.string("post_photo_tips_guidelines"),media:o.media}:{error:o.error,media:[...o.media,{mediaType:e,file:a,description:"",locationId:d,isForCuration:t}]}))})).catch((e=>{f||s({PhotoUploadFlow:{photoUploadWeb:{action:"invalidFile",description:e.message}}}),g(e.message)}))}),[p,n,t,d,c,g,e,b,f,s]),E=o.useCallback((e=>{g(null),e.preventDefault(),[...e.target.files].forEach(k),f||s({PhotoUploadFlow:{photoUploadWeb:{action:"fileSelectedFilePicker",description:m.media.length.toString()}}}),e.currentTarget.value=""}),[k,g,s,f,m.media.length]),C=o.useCallback(((e,a)=>{v((t=>{var o=[...t.media];return o[e]=a,{error:null,media:o}}))}),[]),U=o.useCallback((e=>{v((a=>{var t=[...a.media];return t.splice(e,1),{error:null,media:t}}))}),[]),{dragging:w}=L((e=>{g(null),e.forEach(k)}),f?null:m.media),F=!_&&m.media.length>0&&(!a||!f&&t||m.media.every((e=>e.description&&null!=e.locationId&&e.locationId>0))),[{progress:T},y]=A(),S=o.useCallback((()=>F?(f||s({PhotoUploadFlow:{photoUploadWeb:{action:"submitClicked"}}}),h(!0),g(null),y(m.media).then((e=>(f||s({PhotoUploadFlow:{photoUploadWeb:{action:"uploadedAll"}}}),h(!1),e))).catch((()=>{f||s({PhotoUploadFlow:{photoUploadWeb:{action:"uploadedErrorExists"}}});var e=f?c.string("video_upload_fail"):c.string("post_photo_upload_failed");g(e),h(!1)}))):Promise.reject()),[y,F,m.media,g,c,f,s]);return{media:m.media,error:m.error,uploading:_,progress:T,canAddMore:m.media.length<n,canSubmit:F,dragging:w,onFileSelected:E,onMediaChanged:C,onMediaDeleted:U,onSubmit:S}},j=({children:e,...a})=>{var[t]=o.useContext(d),l=o.useRef(),r={...N,...a},[n,c]=o.useState([]),[{progress:u},p]=A(),m=O(r.allowedFileTypes,r.maxFileSize),v=o.useRef([]),g=o.useCallback((e=>{v.current.splice(0,0,e)}),[]),_=o.useCallback((e=>{var a=v.current.findIndex((a=>e===a));v.current.splice(a,1)}),[]),h=o.useCallback((e=>{Promise.all(e.map((e=>m(e)))).then((()=>{var a=e.map((e=>({mediaType:"photo",file:e,locationId:null,description:"",isForCuration:r.isForCuration})));return c(a),p(a)})).then((e=>{v.current.find((a=>!1!==a(e)))})).catch((e=>{t({node:o.createElement(s,null,e.message||o.createElement(i,{id:"post_photo_upload_failed"}))})})).finally((()=>{c([])}))}),[m,p,t,r.isForCuration]),{dragging:f}=L(h,n),b=o.useCallback((()=>{var e=l.current;if(null==e)throw new Error("useCustomPhotoUploadFlow: must render the supplied element");e.click()}),[]),k=o.useMemo((()=>({photos:n,open:b,dragging:f,progress:u,addPhotosUploadedCallback:g,removePhotosUploadedCallback:_})),[n,b,f,u,g,_]);return o.createElement(x.Provider,{value:k},e,o.createElement("input",{ref:l,type:"file",multiple:r.maxAllowedFiles>1,accept:r.allowedFileTypes.join(","),style:{display:"none"},onChange:e=>{e.preventDefault(),h([...e.currentTarget.files].filter(Boolean)),e.currentTarget.value=""},"aria-hidden":!0,tabIndex:-1}))},q=e=>{var{addPhotosUploadedCallback:a,removePhotosUploadedCallback:t,...l}=o.useContext(x),i=o.useRef(e);return i.current=e,o.useEffect((()=>{if(null==i.current)return()=>{};var e=(...e)=>!!i.current&&i.current(...e);return a(e),()=>{t(e)}}),[a,t]),l},V="fWTfJ _R Gp w",B=({media:e,index:a,mediaCount:t,withMetadata:l=!0,isForCuration:n=!1,hasPresetLocation:d=!1,progress:s,onChange:c,onDelete:u})=>{var{localize:p}=r(),[m,v]=o.useState(!1),[g,_]=o.useState(!1),U=o.useMemo((()=>URL.createObjectURL(e.file)),[e.file]);o.useEffect((()=>()=>URL.revokeObjectURL(U)),[U]);var[w,F]=o.useState(null),T=o.useCallback((()=>u&&u(a)),[u,a]),y=o.useCallback((t=>{v(!1),c(a,{...e,description:t.currentTarget.value})}),[a,e,c]),S=o.useCallback((t=>{F(t),_(!0),c(a,{...e,locationId:null==t?void 0:t.locationId})}),[a,e,c]),N=o.useCallback((()=>{F(null),_(!1),c(a,{...e,locationId:null})}),[a,e,c]),P=m&&!e.description?o.createElement(i,{id:"uploader_error_required_field"}):null,x=g&&(null==e.locationId||e.locationId<=0)?o.createElement(i,{id:"uploader_error_required_field"}):null,I=null!=s,z="video"===e.mediaType?o.createElement(i,{id:"post_video_video_count_text",args:{nCurrentVideoCount:a+1,nTotalVideoCount:t}}):o.createElement(i,{id:"post_photo_video_count_text",args:{nCurrentphotoCount:a+1,nTotalphotoCount:t}});return o.createElement("div",{className:h("eMXUA",{fMrEU:l})},o.createElement("div",{className:"dcebq"},t>1&&o.createElement(b,{variant:"title-05",marginBottom:"spacing-02"},z),o.createElement("div",{className:"dOItz"},"photo"===e.mediaType&&o.createElement("img",{className:V,src:U,alt:""}),"video"===e.mediaType&&o.createElement("video",{controls:!0,controlsList:"nodownload nofullscreen",className:V,alt:""},o.createElement("track",{default:!0,kind:"captions"}),o.createElement("source",{src:U,type:"video/mp4"})),!I&&o.createElement("div",{className:"fIPFT"},o.createElement(k,{size:"small",variant:"dark",iconName:"times","aria-label":p.string("mobile_delete"),onClick:T})),null!=s&&o.createElement("div",{className:"eWuym"},o.createElement(E,{numSteps:e.file.size,currentStep:s})))),l&&o.createElement("div",{className:"bOfWC"},o.createElement(C,{id:`media-upload-description-${a}`,variant:"five-line",label:o.createElement(b,{variant:"title-05"},o.createElement(i,{id:"post_photo_add_description_v2_part_1"})),placeholder:"video"===e.mediaType?p.string("post_video_add_description_v2_part_2"):p.string("post_photo_add_description_v2_part_2"),maxLength:500,characterCountType:P?void 0:"max",required:!0,value:e.description,state:I?"disabled":P?"error":"enabled",errorText:P,onChange:y,onBlur:()=>v(!0),marginBottom:"spacing-03"}),!n&&!d&&o.createElement("div",{className:"bxTDL"},null==w?o.createElement(f,{selectedResultDisplayValue:null==w?void 0:w.searchText,size:"small",errorText:x,placeholder:p.string("photo_uploader_add_a_location_tag"),onTextInputChanged:()=>_(!1),onBlur:()=>_(!0),onSelect:S}):o.createElement(k,{size:"small",variant:"dark",iconName:"times",textPosition:"lead","aria-label":`${w.searchText}. ${p.string("remove_location_cf6")}`,disabled:I,onClick:N},w.title))))},X=(e,a,t=(e=>e))=>{var l=e.match(a);return null!=l?o.createElement(o.Fragment,null,e.substr(0,l.index),t(l[1]||l[0]),e.substr(l.index+l[0].length)):e},K="lgASP Wd _S",Y="bLXyf",H=({plural:e})=>e?t.createElement(i,{id:"post_photo_upload_photos_button"}):t.createElement(i,{id:"confirmed_booker_upload_photo"}),J=({variant:e="large",dragging:a,disabled:t,allowedFileTypes:l=[],onFileSelected:n,mediaType:d,multiple:s=!1,...c})=>{var u=U(),{localize:p}=r();return o.createElement("label",{className:h("WQKPj e u j c z _E B2 BC",w(c),{trCuA:"small"===e,dObPB:"large"===e,eAttt:!t&&a,dKRRC:t,zTzyQ:u})},o.createElement("input",{type:"file",multiple:s,accept:l.join(","),disabled:t,className:"cXCzY Xd",onChange:n,tabIndex:t?"-1":"0"}),"small"===e&&o.createElement(b,{variant:"supporting-01"},o.createElement("span",{className:Y},z("video"===d?p.string("post_video_upload_another_video"):p.string("post_photo_upload_another_video"),/<\/> <span class="{sColorClass1}">(.*)<\/span>/,(e=>o.createElement("span",{className:K},e)))),o.createElement("span",{className:h("clLBK",K)},"video"===d?o.createElement(i,{id:"add_more_videos_mw_uploader"}):o.createElement(i,{id:"add_more_photos_mw_uploader"}))),"large"===e&&o.createElement("div",null,o.createElement(b,{variant:"button-01",marginY:"spacing-03"},o.createElement("div",{className:"oYEFb _S",htmlFor:"media-uploader-file"},"video"===d?o.createElement(i,{id:"add_more_videos_mw_uploader"}):o.createElement(M,{plural:s}))),o.createElement("div",{className:Y,"aria-hidden":!0},o.createElement(b,{variant:"supporting-01",marginY:"spacing-03"},o.createElement(i,{id:"post_photo_or_just_text"})),o.createElement(b,{variant:"title-05",marginY:"spacing-03"},o.createElement(i,{id:"post_photo_drag_and_drop_from_desktop"})))))},G=(e=Object.freeze({}))=>{var a=u(),{login:t}=c(),[r]=o.useContext(d),n=o.useRef((()=>{})),{open:p}=l((({close:a})=>o.createElement(R,Object.assign({},e,{onUploadCanceled:()=>{a(),n.current([])},onUploadSuccess:(...t)=>{a(),r({node:o.createElement(s,null,"video"===e.mediaType?o.createElement(i,{id:"success_repost_video"}):o.createElement(i,{id:"success_repost_photo"}))}),n.current(...t)}}))),{},[e,r]);return o.useCallback((()=>t({flow:"CORE_COMBINED"}).then((()=>(p(),"video"!==e.mediaType&&a({PhotoUploadFlow:{photoUploadWeb:{action:"opened"}}}),new Promise((e=>{n.current=e})))))),[t,p,a,e.mediaType])};return[()=>{(F=JSON.parse('{"kind":"Document","definitions":[{"kind":"OperationDefinition","operation":"mutation","name":{"kind":"Name","value":"InitializeMedia"},"variableDefinitions":[{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"request"}},"type":{"kind":"NonNullType","type":{"kind":"NamedType","name":{"kind":"Name","value":"InitiateMediaUploadRequestInput"}}},"directives":[]}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"initiateMediaUpload"},"arguments":[{"kind":"Argument","name":{"kind":"Name","value":"request"},"value":{"kind":"Variable","name":{"kind":"Name","value":"request"}}}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"mediaId"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"status"},"arguments":[],"directives":[]},{"kind":"Field","name":{"kind":"Name","value":"uploadUrl"},"arguments":[],"directives":[]}]}}]}}],"loc":{"start":0,"end":165}}')).__key=0xc803ecdf4604,T=F,(y=JSON.parse('{"kind":"Document","definitions":[{"kind":"OperationDefinition","operation":"mutation","name":{"kind":"Name","value":"FinalizeMedia"},"variableDefinitions":[{"kind":"VariableDefinition","variable":{"kind":"Variable","name":{"kind":"Name","value":"request"}},"type":{"kind":"NonNullType","type":{"kind":"NamedType","name":{"kind":"Name","value":"CompleteMediaUploadForClientRequestInput"}}},"directives":[]}],"directives":[],"selectionSet":{"kind":"SelectionSet","selections":[{"kind":"Field","name":{"kind":"Name","value":"completeMediaUploadForClient"},"arguments":[{"kind":"Argument","name":{"kind":"Name","value":"request"},"value":{"kind":"Variable","name":{"kind":"Name","value":"request"}}}],"directives":[]}]}}],"loc":{"start":0,"end":138}}')).__key=0x61dd9d92ebbe,S=y,N={mediaType:"photo",withMetadata:!0,isForCuration:!1,allowedFileTypes:[".jpg",".jpeg",".gif",".png"],maxFileSize:v,maxAllowedFiles:10,locationId:-1},P={mediaType:"video",withMetadata:!0,isForCuration:!1,allowedFileTypes:[".mp4",".m4v",".mov"],maxFileSize:g,maxAllowedFiles:5,locationId:-1},x=o.createContext({photos:[],open:()=>{},dragging:!1,progress:null,addPhotosUploadedCallback:()=>{},removePhotosUploadedCallback:()=>{}}),I=B,z=X,M=H,D=J,R=n.onUsage((()=>a("S07X1M/v-c-G4")),"default"),e({C:j,D:D,M:I,a:N,b:G,c:q,d:P,r:z,u:$})},[e=>(t=e,o=e.default),e=>l=e.useVDOMPortal,e=>(i=e.default,r=e.useLocalize),e=>n=e.component,e=>(d=e.Toast,s=e.ToastItem),e=>c=e.default,e=>u=e.useInteractionLogger,e=>p=e.useWindow,e=>(m=e.fileExtension,v=e.maxImageUploadSizeInBytes,g=e.maxVideoUploadSizeInBytes),e=>_=e.useMutation,e=>h=e.default,e=>f=e.LocationSelector,e=>b=e.default,e=>k=e.CircularButton,e=>E=e.default,e=>C=e.TextArea,e=>U=e.useKeyboardNavigationMode,e=>w=e.margin]]},["cDcdfi","vq6MSq","0DsHEV","pLbCP4","Q7TAd7","VANuRt","fsml46","Dg5_-9","V_I8wA","5X2em-","jSLlaY","dAea-m","VP50Wc","7yGKf-","Ly5eaD","7bbexq","W3_c4H","iekllc"]]);
