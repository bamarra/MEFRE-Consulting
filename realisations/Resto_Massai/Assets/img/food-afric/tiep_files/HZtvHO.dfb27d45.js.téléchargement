(this.$WP=this.$WP||[]).push(["HZtvHO",(e,t)=>{"use strict";var a,r,i,n,o,l,s,c,d,u,p,v,T,m,E,S,C,b,I,g,f,k,y,_,h,A,O,M,j,R,L,P,N,x,V,D,w=(e,t)=>{var a,r,i;if(!t)return e;var n=(null==(a=e.paginatedTrips)?void 0:a.trips)||[],o=(null==(r=t.paginatedTrips)?void 0:r.trips)||[];return{paginatedTrips:e.paginatedTrips?{trips:[...n,...o],hasMore:!(null==(i=t.paginatedTrips)||!i.hasMore),__typename:e.paginatedTrips.__typename}:t.paginatedTrips,savedTrips:e.savedTrips}},F=e=>{var t;return{__typename:e.__typename,id:e.id||0,title:e.title||void 0,status:e.status||void 0,photoId:e.photoId||void 0,photo:e.photo||{},route:{url:e.route&&e.route.url||void 0},actionPermissions:{canAddItem:!(null==(t=e.actionPermissions)||!t.canAddItem)}}},U=e=>{var t,r,i,n,o,s=(t,a)=>{if(!t||!a)return"invalidateAndRefetch";var{originalObject:r}=e;return r&&a===r.type&&t===String(r.id)||a===e.type&&t===String(e.id)?"invalidateAndRefetch":"validate"},{userId:c}=a.useContext(u),d={offset:0,limit:10,userId:c||"",reference:l(e),loadSavedTrips:!0},[p,v]=h({query:O,variables:d,combineData:w,showFetchingAfterFirstQuery:!0,invalidationPredicates:{createTrip:()=>"invalidateAndRefetch",cloneTrip:()=>"invalidateAndRefetch",tripsDelete:()=>"invalidateAndRefetch",addItemToTrip:({variables:{referenceId:e,referenceType:t}})=>s(e,t),moveTripItem:({variables:{reference:e}})=>s(null==e?void 0:e.id,null==e?void 0:e.type),tripsRemoveItem:({variables:{reference:e}})=>s(null==e?void 0:e.id,null==e?void 0:e.type),tripsRemoveReference:({variables:{reference:e}})=>s(null==e?void 0:e.id,null==e?void 0:e.type)}}),T=(null==(t=p.data)||null==(r=t.paginatedTrips)?void 0:r.trips)||[],m=T.slice().filter(Boolean).map(F),E=!(null==(i=p.data)||null==(n=i.paginatedTrips)||!n.hasMore),S=(null==(o=p.data)?void 0:o.savedTrips)||[],C=new Set(S.map((e=>null==e?void 0:e.id)).filter(Boolean)),b=E?()=>v({offset:(null==T?void 0:T.length)||0,loadSavedTrips:!1}):()=>Promise.resolve();return{fetching:p.fetching,error:!!p.error,data:{tripList:m,saveSet:C,canMakePublicTrip:!0},hasMore:E,loadMore:b}},G="cYchV Fn f u j",W="esVrA",q=({saveObject:e,overlayState:t,validateTripName:i,lastSavedItem:n,trackingContext:o,trackingSource:l,...c})=>{var d,[u,p]=a.useState(!0),{fetching:v,error:T,data:m,hasMore:E,loadMore:S}=M(e);v?d=a.createElement(g,{size:"large"}):T&&(d=a.createElement(_,{refetch:S})),a.useEffect((()=>{v||p(!1)}),[]);var[C]=r({source:l||"trips",trackingContext:o,pageAsContext:!0,withSaveSession:!0}),f=()=>{c.onClose(),p(!0)},k=j[t](e.type),h=a.createElement(I,{iconName:"heart",displayType:"LEFT_ALIGN_GRAY"},k);return a.createElement(y,{element:"bundleSave"===e.type?"copyTripModal":"saveTripModal"},a.createElement(b,{header:h,closeIconColor:"BLACK",bodyProps:{isFullBleed:!0},onClose:f},d&&u?a.createElement("div",{className:G},d):(()=>{var r=n?s(n):void 0,u=()=>a.createElement("div",{className:W},a.createElement(R,{gate:()=>Promise.resolve(),object:e,onMount:()=>{v||T||C({elementClick:{element:"createTrip"}})},onAddedToCreatedTrip:e=>{c.statCallback("ADD","NEW",e,!0,!0),f()},onError:c.onError,canMakePublicTrip:m.canMakePublicTrip,validateTripName:i,trackingContext:o,trackingSource:l}));switch(t){case"DEFAULT":return 0===m.tripList.length?u():a.createElement(P,{tripList:m.tripList,savedSet:m.saveSet,tripListBottom:d,onPaginate:S,hasMore:E,saveObject:e,onMount:()=>{c.preventInteractionInMountedComponents||C({elementClick:{element:"stat"}})},onCreateTrip:()=>{c.onCreateTripClicked&&c.onCreateTripClicked()},tripAction:"SAVE",onRemovedFromTrip:(e,t,a)=>{c.statCallback("REMOVE","EXISTING",e,t,a),f()},onSavedToTrip:(e,t,a)=>{c.statCallback("ADD","EXISTING",e,t,a),f()},onError:c.onError,trackingContext:o,trackingSource:l});case"CREATE":return u();case"SELECT":return r?a.createElement(P,{tripList:m.tripList,savedSet:m.saveSet,tripListBottom:d,onPaginate:S,hasMore:E,saveObject:r,onMount:()=>{C({elementClick:{element:"stat"}})},onCreateTrip:()=>{c.onSelectCreateTripClicked&&c.onSelectCreateTripClicked()},tripAction:"MOVE",onMovedToTrip:(e,t,a)=>{c.statCallback("MOVE","EXISTING",e,t,a),f()},onRemovedFromTrip:(e,t,a)=>{c.statCallback("REMOVE","EXISTING",e,t,a),f()},onError:c.onError,trackingContext:o,trackingSource:l}):"";case"SELECT_CREATE":return n?a.createElement("div",{className:W},a.createElement(L,{gate:()=>Promise.resolve(),item:n,onMovedToCreatedTrip:e=>{c.statCallback("MOVE","NEW",e,!0,!0),f()},canMakePublicTrip:m.canMakePublicTrip})):u();default:return""}})()))},Q=e=>{},B=(e,t)=>{switch(t.type){case"setOverlayState":return{...e,overlayState:t.state};case"afterSave":return{...e,overlayState:"DEFAULT",preventInteractionInMountedComponents:!0};default:throw new Error}},H=({allowPopStatModal:e,logInteraction:t,puid:r,object:i,active:o,preventInteractionPropagation:l,trackingContext:s,trackingSource:c,resaveTrip:p,saveObject:v,saveStatus:T,updateLastTripId:m,onClose:C,initialOverlayState:b,...I})=>{var g,{userId:f}=a.useContext(u),{launchViewTripToast:k,launchRemoveFromTripToast:y,launchErrorTripToast:_}=d(),{getTripErrorMessage:h}=E(),A=S("SAVE_TO_TRIP_INTENT"),O=S("SAVE_TO_TRIP"),M=S({type:"CREATE_TRIP",payload:{user_id:f||""}}),j=a.useContext(n),[R,L]=a.useReducer(B,{overlayState:b||"DEFAULT",preventInteractionInMountedComponents:!1}),P=a.useRef(!0);a.useEffect((()=>()=>{P.current=!1}),[]);var{onComplete:x}=I,V=a.useCallback((e=>{x&&x(e),j.resetSession()}),[x,j]),D=a.useCallback(((e,a)=>{e&&!a?(k(e,"SAVED",(()=>{t({elementClick:{element:"saved_viewTrip"}})})),V(!0)):a&&(_(a),V(!1)),P.current&&L({type:"setOverlayState",state:"DEFAULT"}),t({elementClick:{element:"unsave_undo"}})}),[k,V,_,t]),w=a.useCallback((e=>{y(e,v,D)}),[y,D,v]),F=a.useCallback((e=>{_(e)}),[_]),[U,G]=a.useState(!1),W=a.useCallback((()=>{G(!0),j.resetSession()}),[j]),q=a.useCallback(((e,a)=>{"CREATED"===a&&(O(),M()),P.current&&L({type:"afterSave"}),k(e,a,(()=>{t({elementClick:{element:"saved_viewTrip"}})})),m(e.id),V(!0)}),[O,k,V,m,M,t]);return!U&&a.createElement("div",{className:"stat_wrapper",onClick:e=>{e.stopPropagation(),e.preventDefault(),!l&&f&&t({elementClick:{element:"item_save",tripId:null==p?void 0:p.id}}),o||A()}},a.createElement(N,{saveObject:v,overlayState:R.overlayState,lastSavedItem:null==(g=T.result)?void 0:g.tripItem,trackingContext:s,trackingSource:c,onCreateTripClicked:()=>{P.current&&L({type:"setOverlayState",state:"CREATE"})},onSelectCreateTripClicked:()=>{P.current&&L({type:"setOverlayState",state:"SELECT_CREATE"})},onClose:W,onError:F,preventInteractionInMountedComponents:R.preventInteractionInMountedComponents,statCallback:(e,t,a,r,i)=>{"REMOVE"===e?(w(a),V(i)):"NEW"===t?q(a,"CREATED"):r&&q(a,"SAVED")},validateTripName:e=>{if("bundleSave"===v.type&&e.trim().toLowerCase()===i.title.trim().toLowerCase())return h("COPY_TRIP",{type:"INVALID_VALUE",field:"TITLE"})}}))},X=e=>a.createElement(i,null,a.createElement(C,null,a.createElement(H,e))),z=["Profile","HomeFeed","Trips","Home"],$=e=>{var t=a.useMemo((()=>e.saveObject||s(e.object,!0)),[e.saveObject,e.object]),{resaveTrip:i,onComplete:l,allowPopStatModal:c}=e,{isNativeWebview:u,tripId:E,...S}=e,{launchAutoSavedToTripToast:C,launchErrorTripToast:b}=d(),[I]=a.useContext(p),{page:g}=I,f=a.useMemo((()=>({source:e.trackingSource||"trips",saveObject:t,trackingContext:e.trackingContext,withSaveSession:!0,pageAsContext:!0})),[e.trackingContext,e.trackingSource,t]),[k,y]=r(f),_=a.useContext(n),[h,A,O]=v(E,t,e.active),M=null==t?void 0:t.id,j=null==t?void 0:t.type,R=a.useCallback((e=>{b(e)}),[b]),L=a.useCallback((()=>{k({elementClick:{element:"ITEM_SAVE_LOGIN",context:g&&o(g)||void 0,puid:y,saveType:j,detailId:M?`${M}`:"",tripId:null==i?void 0:i.id,sessionType:"SAVE",sessionUuid:_.sessionUuid,sessionOrder:_.sessionOrder}})}),[k,g,y,i,M,j,_.sessionOrder,_.sessionUuid]),P=a.useCallback((()=>{k({modalSuccess:{element:"ITEM_SAVE_LOGIN",context:g&&o(g)||void 0,puid:y,saveType:j,detailId:M?`${M}`:"",tripId:null==i?void 0:i.id,sessionType:"SAVE",sessionUuid:_.sessionUuid,sessionOrder:_.sessionOrder}})}),[k,g,y,i,M,j,_.sessionOrder,_.sessionUuid]),N=a.useMemo((()=>({pid:g&&z.includes(I.page)?40439:39766,flow:u?"NATIVE_LOGIN":"SAVES_COMBINED",onLogin:L,onSuccess:P,isFullWidthMobile:!0})),[L,P,g,I.page,u]),V=T(N),D=a.useRef(!1),{open:w}=m((()=>t?a.createElement(x,Object.assign({},S,{logInteraction:k,puid:y,saveObject:t,saveStatus:h,updateLastTripId:O})):null)),{open:F}=m((()=>t?a.createElement(x,Object.assign({},S,{initialOverlayState:"SELECT",logInteraction:k,puid:y,saveObject:t,saveStatus:h,updateLastTripId:O})):null)),U=!!c&&(I.params.popStat||!1);return a.useEffect((()=>{U&&!D.current&&(D.current=!0,k({elementClick:{element:"autoPopStat"}}),V().then(w))}),[k,V,w,U]),a.useCallback((()=>{V().then((()=>A())).then((([e,t])=>{null!==e||null!==t?t?R({query:"ADD_ITEM_TO_TRIP",tripsError:t}):e&&(C(e,(()=>{F(),k({elementClick:{element:"quickSave_change"}})})),k({modalSuccess:{element:"quickSave",tripId:null==i?void 0:i.id,context:g&&o(g)||void 0,saveType:j,detailId:M?`${M}`:""}}),l&&l(!0)):w()}))}),[w,F,C,k,V,l,R,A,g,i,M,j])},K=({children:e,...t})=>{var r=a.useMemo((()=>t.saveObject||s(t.object,!0)),[t.saveObject,t.object]),n=V(t);return r?a.createElement(i,null,e(n)):null},Y=({queryObject:e,children:t,...r})=>{var i,n,o,l,s,c,d,p,v,[T,m]=a.useState(null!=(i=r.object)&&null!=(n=i.object)&&n.socialStatistics?!(null==(o=r.object)||null==(l=o.object)||null==(s=l.socialStatistics)||!s.isSaved):!(null==(c=r.object)||null==(d=c.socialStatistics)||!d.isSaved)),E=(t,a)=>{if(!t||!a)return"invalidateAndRefetch";var{originalObject:r}=e;return r&&a===r.type&&t===String(r.id)||a===e.type&&t===String(e.id)?"invalidateAndRefetch":"validate"},{userId:S}=a.useContext(u);v=S?null!=(p=r.object)&&p.socialStatistics?"afterInvalidation":"immediately":"never";var[{fetching:C,data:b,error:I}]=A({query:e.query,variables:e.variables,executeWhen:v},{addItemToTrip:({variables:{referenceId:e,referenceType:t}})=>E(e,t),tripsRemoveItem:({variables:{reference:e}})=>E(null==e?void 0:e.id,null==e?void 0:e.type),tripsRemoveReference:({variables:{reference:e}})=>E(e.id,null==e?void 0:e.type)});return a.useEffect((()=>{if(!C&&!I){var t=b&&b.savesObjects&&b.savesObjects[0];if(t){var{id:a,socialStatistics:r={}}=t,i=(a===e.id||String(a)===e.id)&&!!r.isSaved;i!==T&&m(i)}}}),[C,b,I]),a.createElement(D,Object.assign({active:T},r),(e=>t(e,T,C)))},J=e=>{var t=e.saveObject||s(e.object,!0);if(!t)return console.error("An invalid saves object was passed to QueriedTripFlowSelector"),null;var r=c(t);return r?a.createElement(Y,Object.assign({},e,{queryObject:r})):(console.error("Unsupported saves object was passed to QueriedTripFlowSelector"),null)};return[()=>{M=U,j=Object.freeze({DEFAULT:e=>"bundleSave"!==e?a.createElement(f,{id:"stat_modal_save_to_trip_v2"}):a.createElement(f,{id:"save_all_items_modal_header"}),CREATE:()=>a.createElement(f,{id:"stat_modal_create_a_trip_v2"}),SELECT:()=>a.createElement(f,{id:"select_trip_header"}),SELECT_CREATE:()=>a.createElement(f,{id:"stat_modal_create_a_trip_v2"})}),R=k.component.onUsage((()=>t("neHaXV")),"CreateTripWithAddItemModal",a.createElement("div",{className:G},a.createElement(g,{size:"large"}))),L=k.component.onUsage((()=>t("neHaXV")),"CreateTripWithMoveItemModal",a.createElement("div",{className:G},a.createElement(g,{size:"large"}))),P=k.component.onUsage((()=>t("pBQaod")),"SaveToTripContent",a.createElement("div",{className:G},a.createElement(g,{size:"large"}))),N=q,H.defaultProps={preventInteractionPropagation:!1,onComplete:void 0,trackingContext:void 0,allowPopStatModal:!1},x=X,V=$,D=K,J.defaultProps={object:null,trackingContext:void 0,allowPopStatModal:!1},e({QueriedTripFlowSelector:J,TripFlowSelector:D,setSTATDisabledForTesting:Q})},[e=>a=e,e=>(r=e.useTripInteraction,i=e.SaveSessionProvider,n=e.SaveSessionTrackingContext,o=e.getInteractionsContext),e=>(l=e.toReference,s=e.toSavesObject,c=e.objectStatisticQuery),e=>d=e.default,e=>(u=e.Visitor,p=e.Route),e=>v=e.useAutosave,e=>T=e.useSocialLoginGate,e=>m=e.useVDOMPortal,e=>E=e.useLocalizeTripError,e=>S=e.usePixelCallback,e=>C=e.ToastProvider,e=>b=e.default,e=>I=e.TitleBar,e=>g=e.LoadingSpinner,e=>f=e.default,e=>k=e,e=>y=e.TripsImpression,e=>_=e.default,e=>(h=e.usePaginatedQuery,A=e.useInvalidatableQuery),e=>O=e.TripDetailStatQuery]]},["cDcdfi","U-DhDC","eFKnUp","PiTJFd","2R4xv2","fTyhRT","JFHNGL","vq6MSq","9I0t-6","jb_4W2","Q7TAd7","O8LbtK","6nM-E7","V08PS7","0DsHEV","pLbCP4","c_rvp5","LFeTN6","OnmvvE","RXx5aI"]]);
